{"version":3,"file":"lg-video.umd.js","sources":["../../src/plugins/video/lg-video-settings.ts","../../src/plugins/video/lg-video.ts"],"sourcesContent":["export interface VideoDefaults {\n    videoMaxWidth: string;\n    autoplayFirstVideo: boolean;\n    youtubePlayerParams: any;\n    vimeoPlayerParams: any;\n    wistiaPlayerParams: any;\n    gotoNextSlideOnVideoEnd: boolean;\n    autoplayVideoOnSlide: boolean;\n    videojs: boolean;\n    videojsOptions: any;\n}\nexport const videoDefaults: VideoDefaults = {\n    videoMaxWidth: '855px',\n\n    autoplayFirstVideo: true,\n\n    youtubePlayerParams: false,\n    vimeoPlayerParams: false,\n    wistiaPlayerParams: false,\n    gotoNextSlideOnVideoEnd: true,\n    autoplayVideoOnSlide: false, // Make sure you set preload:\"none\"\n\n    videojs: false,\n    videojsOptions: {},\n};\n","/**\n * Video module for lightGallery\n * Supports HTML5, YouTube, Vimeo, wistia videos\n *\n *\n * @ref Wistia\n * https://wistia.com/support/integrations/wordpress(How to get url)\n * https://wistia.com/support/developers/embed-options#using-embed-options\n * https://wistia.com/support/developers/player-api\n * https://wistia.com/support/developers/construct-an-embed-code\n * http://jsfiddle.net/xvnm7xLm/\n * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video\n *\n * @ref Youtube\n * https://developers.google.com/youtube/player_parameters#enablejsapi\n * https://developers.google.com/youtube/iframe_api_reference\n *\n */\n\nimport { VideoDefaults, videoDefaults } from './lg-video-settings';\nimport { LightGallery } from '../../lightgallery';\nimport { lgQuery } from '../../lgQuery';\nimport { CustomEventHasVideo } from '../../types';\ndeclare let YT: any;\ndeclare let Vimeo: any;\ndeclare let videojs: any;\n\ndeclare global {\n    interface Window {\n        _wq: any;\n        Vimeo: any;\n    }\n}\n\ndeclare global {\n    interface Window {\n        LG: (selector: any) => lgQuery;\n    }\n}\n\nfunction param(obj: { [x: string]: string | number | boolean }): string {\n    return Object.keys(obj)\n        .map(function (k) {\n            return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]);\n        })\n        .join('&');\n}\n\nexport class Video {\n    private core: LightGallery;\n    private s: VideoDefaults;\n    constructor(instance: LightGallery) {\n        this.core = instance;\n        this.s = Object.assign({}, videoDefaults, this.core.s);\n\n        this.init();\n\n        return this;\n    }\n    init() {\n        /**\n         * Event triggered when video url found without poster\n         * Append video HTML\n         * Play if autoplayFirstVideo is true\n         */\n        this.core.LGel.on('hasVideo.lg.video', this.onHasVideo.bind(this));\n\n        // Set max width for video\n        this.core.LGel.on(\n            'onAferAppendSlide.lg.video',\n            this.onAferAppendSlide.bind(this),\n        );\n\n        if (\n            this.core.doCss() &&\n            this.core.galleryItems.length > 1 &&\n            (this.core.s.enableSwipe || this.core.s.enableDrag)\n        ) {\n            this.core.LGel.on('onSlideClick.lg.video', () => {\n                const $el = this.core.getSlideItem(this.core.index);\n                this.loadVideoOnPosterClick($el);\n            });\n        } else {\n            // For IE 9 and bellow\n            this.core.outer\n                .find('.lg-item')\n                .first()\n                .on('click.lg', () => {\n                    const $el = this.core.getSlideItem(this.core.index);\n                    this.loadVideoOnPosterClick($el);\n                });\n        }\n\n        // @desc fired immediately before each slide transition.\n        this.core.LGel.on(\n            'onBeforeSlide.lg.video',\n            this.onBeforeSlide.bind(this),\n        );\n\n        // @desc fired immediately after each slide transition.\n        this.core.LGel.on(\n            'onAfterSlide.lg.video',\n            this.onAfterSlide.bind(this),\n        );\n    }\n\n    /**\n     * @desc Event triggered when video url or poster found\n     * Append video HTML is poster is not given\n     * Play if autoplayFirstVideo is true\n     *\n     * @param {Event} event - Javascript Event object.\n     * @param {number} index - Current index of the slide\n     * @param {string} src - src of the video\n     * @param {string} html - HTML5 video\n     */\n    onHasVideo(event: CustomEventHasVideo): void {\n        const { index, src, html5Video, hasPoster } = event.detail;\n        if (!hasPoster) {\n            // All functions are called separately if poster exist in loadVideoOnPosterClick function\n\n            this.appendVideos(this.core.getSlideItem(index), {\n                src,\n                addClass: 'lg-object',\n                index,\n                html5Video,\n            });\n\n            // Automatically navigate to next slide once video reaches the end.\n            this.gotoNextSlideOnVideoEnd(src, index);\n        }\n\n        if (this.s.autoplayFirstVideo && !this.core.lGalleryOn) {\n            if (hasPoster) {\n                const $slide = this.core.getSlideItem(index);\n                this.loadVideoOnPosterClick($slide);\n            } else {\n                this.playVideo(index);\n            }\n        }\n    }\n\n    /**\n     * @desc Fired when the slide content has been inserted into its slide container.\n     * Set max width for video\n     *\n     * @param {Event} event - Javascript Event object.\n     * @param {number} index - Current index of the slide\n     */\n    onAferAppendSlide(event: CustomEvent) {\n        const $videoCont = this.core\n            .getSlideItem(event.detail.index)\n            .find('.lg-video-cont')\n            .first();\n        if (!$videoCont.hasClass('lg-has-iframe')) {\n            $videoCont.css('max-width', this.s.videoMaxWidth);\n        }\n    }\n\n    /**\n     * @desc fired immediately before each slide transition.\n     * Pause the previous video\n     * Hide the download button if the slide contains YouTube, Vimeo, or Wistia videos.\n     *\n     * @param {Event} event - Javascript Event object.\n     * @param {number} prevIndex - Previous index of the slide.\n     * @param {number} index - Current index of the slide\n     */\n    onBeforeSlide(event: CustomEvent) {\n        const { prevIndex, index } = event.detail;\n        this.pauseVideo(prevIndex);\n\n        const _videoInfo = this.core.galleryItems[index].__slideVideoInfo || {};\n        if (_videoInfo.youtube || _videoInfo.vimeo || _videoInfo.wistia) {\n            this.core.outer.addClass('lg-hide-download');\n        }\n    }\n\n    /**\n     * @desc fired immediately after each slide transition.\n     * Play video if autoplayVideoOnSlide option is enabled.\n     *\n     * @param {Event} event - Javascript Event object.\n     * @param {number} prevIndex - Previous index of the slide.\n     * @param {number} index - Current index of the slide\n     */\n    onAfterSlide(event: CustomEvent) {\n        const { prevIndex, index } = event.detail;\n        if (this.s.autoplayVideoOnSlide && this.core.lGalleryOn) {\n            this.core.getSlideItem(prevIndex).removeClass('lg-video-playing');\n            setTimeout(() => {\n                const $slide = this.core.getSlideItem(index);\n                if (\n                    $slide.find('.lg-object').first().hasClass('lg-has-poster')\n                ) {\n                    this.loadVideoOnPosterClick($slide);\n                } else {\n                    this.playVideo(index);\n                }\n            }, 100);\n        }\n    }\n\n    /**\n     * Play HTML5, Youtube, Vimeo or Wistia videos in a particular slide.\n     * @param {number} index - Index of the slide\n     */\n    playVideo(index: number) {\n        this.controlVideo(index, 'play');\n    }\n\n    /**\n     * Pause HTML5, Youtube, Vimeo or Wistia videos in a particular slide.\n     * @param {number} index - Index of the slide\n     */\n    pauseVideo(index: number) {\n        this.controlVideo(index, 'pause');\n    }\n\n    getVideoHtml(\n        src: any,\n        addClass: any,\n        index: number,\n        html5Video: { source: string | any[]; [key: string]: any },\n    ) {\n        let video = '';\n        const videoInfo =\n            this.core.galleryItems[(index as unknown) as number]\n                .__slideVideoInfo || {};\n        const currentDynamicItem = this.core.galleryItems[index];\n        let videoTitle = currentDynamicItem.title || currentDynamicItem.alt;\n        videoTitle = videoTitle ? 'title=\"' + videoTitle + '\"' : '';\n        const commonIframeProps = `allowtransparency=\"true\" \n            frameborder=\"0\" \n            scrolling=\"no\" \n            allowfullscreen \n            mozallowfullscreen \n            webkitallowfullscreen \n            oallowfullscreen \n            msallowfullscreen`;\n\n        if (videoInfo.youtube) {\n            const videoId = 'lg-youtube' + index;\n\n            const youtubePlayerParams = `?wmode=opaque&autoplay=0&enablejsapi=1`;\n\n            const playerParams =\n                youtubePlayerParams + '&' + param(this.s.youtubePlayerParams);\n\n            video = `<iframe allow=\"autoplay\" id=${videoId} class=\"lg-video-object lg-youtube ${addClass}\" ${videoTitle} src=\"//www.youtube.com/embed/${\n                videoInfo.youtube[1] + playerParams\n            }\" ${commonIframeProps}></iframe>`;\n        } else if (videoInfo.vimeo) {\n            const videoId = 'lg-vimeo' + index;\n            const playerParams = param(this.s.vimeoPlayerParams);\n\n            video = `<iframe allow=\"autoplay\" id=${videoId} class=\"lg-video-object lg-vimeo ${addClass}\" ${videoTitle} src=\"//player.vimeo.com/video/${\n                videoInfo.vimeo[1] + playerParams\n            }\" ${commonIframeProps}></iframe>`;\n        } else if (videoInfo.wistia) {\n            const wistiaId = 'lg-wistia' + index;\n            const playerParams = param(this.s.wistiaPlayerParams);\n            video = `<iframe allow=\"autoplay\" id=\"${wistiaId}\" src=\"//fast.wistia.net/embed/iframe/${\n                videoInfo.wistia[4] + playerParams\n            }\" ${videoTitle} class=\"wistia_embed lg-video-object lg-wistia ${addClass}\" name=\"wistia_embed\" ${commonIframeProps}></iframe>`;\n        } else if (videoInfo.html5) {\n            let html5VideoMarkup = '';\n            for (let i = 0; i < html5Video.source.length; i++) {\n                html5VideoMarkup += `<source src=\"${html5Video.source[i].src}\" type=\"${html5Video.source[i].type}\">`;\n            }\n\n            let html5VideoAttrs = '';\n\n            Object.keys(html5Video).forEach(function (key) {\n                if (key !== 'source') {\n                    html5VideoAttrs += `${key}=\"${html5Video[key]}\" `;\n                }\n            });\n            video = `<video class=\"lg-video-object lg-html5 ${\n                this.s.videojs ? 'video-js' : ''\n            }\" ${html5VideoAttrs}>\n                ${html5VideoMarkup}\n                Your browser does not support HTML5 video.\n            </video>`;\n        }\n\n        return video;\n    }\n\n    /**\n     * @desc - Append videos to the slide\n     *\n     * @param {HTMLElement} el - slide element\n     * @param {Object} videoParams - Video parameters, Contains src, class, index, htmlVideo\n     */\n    appendVideos(\n        el: lgQuery,\n        videoParams: { src: any; addClass: any; index: any; html5Video: any },\n    ) {\n        const videoHtml = this.getVideoHtml(\n            videoParams.src,\n            videoParams.addClass,\n            videoParams.index,\n            videoParams.html5Video,\n        );\n        el.find('.lg-video').append(videoHtml);\n        const $videoElement = el.find('.lg-video-object').first();\n        if (this.s.videojs) {\n            try {\n                videojs($videoElement.get(), this.s.videojsOptions);\n            } catch (e) {\n                console.error(\n                    'lightGallery:- Make sure you have included videojs',\n                );\n            }\n        }\n        this.core.LGel.trigger('onAppendVideo.lg', [\n            $videoElement,\n            videoParams.index,\n        ]);\n    }\n\n    gotoNextSlideOnVideoEnd(src: any, index: number) {\n        const $videoElement = this.core\n            .getSlideItem(index)\n            .find('.lg-video-object')\n            .first();\n        const videoInfo = this.core.galleryItems[index].__slideVideoInfo || {};\n        if (this.s.gotoNextSlideOnVideoEnd) {\n            if (videoInfo.html5) {\n                $videoElement.on('ended', () => {\n                    this.core.goToNextSlide();\n                });\n            } else if (videoInfo.youtube) {\n                try {\n                    new YT.Player($videoElement.attr('id'), {\n                        events: {\n                            onStateChange: (event: { data: any }) => {\n                                if (event.data === YT.PlayerState.ENDED) {\n                                    this.core.goToNextSlide();\n                                }\n                            },\n                        },\n                    });\n                } catch (e) {\n                    console.error(\n                        'lightGallery:- Make sure you have included //www.youtube.com/iframe_api',\n                    );\n                }\n            } else if (videoInfo.vimeo) {\n                try {\n                    // https://github.com/vimeo/player.js/#ended\n                    new Vimeo.Player($videoElement.get()).on('ended', () => {\n                        this.core.goToNextSlide();\n                    });\n                } catch (e) {\n                    console.error(\n                        'lightGallery:- Make sure you have included //github.com/vimeo/player.js',\n                    );\n                }\n            } else if (videoInfo.wistia) {\n                try {\n                    window._wq = window._wq || [];\n\n                    // @todo Event is gettign triggered multiple times\n                    window._wq.push({\n                        id: $videoElement.attr('id'),\n                        onReady: (video: {\n                            bind: (arg0: string, arg1: () => void) => void;\n                        }) => {\n                            video.bind('end', () => {\n                                this.core.goToNextSlide();\n                            });\n                        },\n                    });\n                } catch (e) {\n                    console.error(\n                        'lightGallery:- Make sure you have included //fast.wistia.com/assets/external/E-v1.js',\n                    );\n                }\n            }\n        }\n    }\n\n    controlVideo(index: number, action: string) {\n        const $videoElement = this.core\n            .getSlideItem(index)\n            .find('.lg-video-object')\n            .first();\n        const videoInfo = this.core.galleryItems[index].__slideVideoInfo || {};\n\n        if (!$videoElement.get()) return;\n\n        if (videoInfo.youtube) {\n            try {\n                // @todo Do not create multiple player instences\n                // Create and store in dynamic array\n                new YT.Player($videoElement.attr('id'), {\n                    events: {\n                        onReady: function (event: any) {\n                            event.target[`${action}Video`]();\n                        },\n                    },\n                });\n            } catch (e) {\n                console.error(\n                    'lightGallery:- Make sure you have included //www.youtube.com/iframe_api',\n                );\n            }\n        } else if (videoInfo.vimeo) {\n            try {\n                new Vimeo.Player($videoElement.get())[action]();\n            } catch (e) {\n                console.error(\n                    'lightGallery:- Make sure you have included //github.com/vimeo/player.js',\n                );\n            }\n        } else if (videoInfo.html5) {\n            if (this.s.videojs) {\n                try {\n                    (videojs($videoElement.get()) as any)[action as any]();\n                } catch (e) {\n                    console.error(\n                        'lightGallery:- Make sure you have included videojs',\n                    );\n                }\n            } else {\n                ($videoElement.get() as any)[action]();\n            }\n        } else if (videoInfo.wistia) {\n            try {\n                window._wq = window._wq || [];\n\n                // @todo Find a way to destroy wistia player instance\n                window._wq.push({\n                    id: $videoElement.attr('id'),\n                    onReady: (video: any) => {\n                        video[action]();\n                    },\n                });\n            } catch (e) {\n                console.error(\n                    'lightGallery:- Make sure you have included //fast.wistia.com/assets/external/E-v1.js',\n                );\n            }\n        }\n    }\n\n    loadVideoOnPosterClick($el: lgQuery) {\n        // check slide has poster\n        if (\n            $el.find('.lg-object').first().hasClass('lg-has-poster') &&\n            $el.find('.lg-object').first().style().display !== 'none'\n        ) {\n            // check already video element present\n            if (!$el.hasClass('lg-has-video')) {\n                $el.addClass('lg-video-playing lg-has-video');\n\n                let _html;\n\n                const _src = this.core.galleryItems[this.core.index].src;\n                if (this.core.galleryItems[this.core.index].video) {\n                    _html = JSON.parse(\n                        this.core.galleryItems[this.core.index].video,\n                    );\n                }\n\n                this.appendVideos($el, {\n                    src: _src,\n                    addClass: '',\n                    index: this.core.index,\n                    html5Video: _html,\n                });\n\n                this.gotoNextSlideOnVideoEnd(_src, this.core.index);\n                this.playVideo(this.core.index);\n\n                const $tempImg = $el.find('.lg-object').first().get();\n\n                // @todo make sure it is working\n                $el.find('.lg-video').first().append($tempImg);\n\n                // @todo loading icon for html5 videos also\n                // for showing the loading indicator while loading video\n                if (\n                    !$el.find('.lg-video-object').first().hasClass('lg-html5')\n                ) {\n                    $el.removeClass('lg-complete');\n                    $el.find('.lg-video-object')\n                        .first()\n                        .on('load.lg error.lg', () => {\n                            $el.addClass('lg-complete');\n                        });\n                }\n            } else {\n                this.playVideo(this.core.index);\n\n                $el.addClass('lg-video-playing');\n            }\n        }\n    }\n    destroy(clear?: boolean): void {\n        if (clear) {\n            this.core.LGel.off('.lg.video');\n        }\n    }\n}\n\nwindow.lgModules.video = Video;\n"],"names":[],"mappings":"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"}