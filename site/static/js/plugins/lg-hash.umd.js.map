{"version":3,"file":"lg-hash.umd.js","sources":["../../src/plugins/hash/lg-hash.ts"],"sourcesContent":["import { lgQuery } from '../../lgQuery';\nimport { LightGallery } from '../../lightgallery';\n\ndeclare global {\n    interface Window {\n        LG: (selector: any) => lgQuery;\n    }\n}\n\nconst LG = window.LG;\n\nconst defaults = {\n    hash: true,\n};\nexport class Hash {\n    core: LightGallery;\n    s: { hash: boolean };\n    oldHash!: string;\n    constructor(instance: LightGallery) {\n        // get lightGallery core plugin data\n        this.core = instance;\n        // extend module default settings with lightGallery core settings\n        this.s = Object.assign({}, defaults, this.core.s);\n\n        if (this.s.hash) {\n            this.oldHash = window.location.hash;\n            this.init();\n        }\n\n        return this;\n    }\n\n    init() {\n        // Change hash value on after each slide transition\n        this.core.LGel.on('onAfterSlide.lg.hash', this.onAfterSlide.bind(this));\n        this.core.LGel.on('onCloseAfter.lg.hash', this.onCloseAfter.bind(this));\n\n        // Listen hash change and change the slide according to slide value\n        LG(window).on(\n            `hashchange.lg.hash.global${this.core.lgId}`,\n            this.onHashchange.bind(this),\n        );\n    }\n\n    onAfterSlide(event: CustomEvent) {\n        let slideName = this.core.galleryItems[event.detail.index].slideName;\n        slideName = this.core.s.customSlideName\n            ? slideName || event.detail.index\n            : event.detail.index;\n        if (history.replaceState) {\n            history.replaceState(\n                null,\n                '',\n                window.location.pathname +\n                    window.location.search +\n                    '#lg=' +\n                    this.core.s.galleryId +\n                    '&slide=' +\n                    slideName,\n            );\n        } else {\n            window.location.hash =\n                'lg=' + this.core.s.galleryId + '&slide=' + slideName;\n        }\n    }\n\n    onCloseAfter() {\n        // Reset to old hash value\n        if (\n            this.oldHash &&\n            this.oldHash.indexOf('lg=' + this.core.s.galleryId) < 0\n        ) {\n            if (history.replaceState) {\n                history.replaceState(null, '', this.oldHash);\n            } else {\n                window.location.hash = this.oldHash;\n            }\n        } else {\n            if (history.replaceState) {\n                history.replaceState(\n                    null,\n                    document.title,\n                    window.location.pathname + window.location.search,\n                );\n            } else {\n                window.location.hash = '';\n            }\n        }\n    }\n\n    onHashchange() {\n        if (!this.core.lgOpened) return;\n        const _hash = window.location.hash;\n        const index = this.core.getIndexFromUrl(_hash);\n\n        // it galleryId doesn't exist in the url close the gallery\n        if (_hash.indexOf('lg=' + this.core.s.galleryId) > -1) {\n            this.core.slide(index, false, false);\n        } else if (this.core.lGalleryOn) {\n            this.core.destroy();\n        }\n    }\n\n    destroy(clear?: boolean): void {\n        if (!this.s.hash) {\n            return;\n        }\n        if (clear) {\n            this.core.LGel.off('.lg.hash');\n            LG(window).off(`hashchange.lg.hash.global${this.core.lgId}`);\n        }\n    }\n}\n\nwindow.lgModules = window.lgModules || {};\nwindow.lgModules.hash = Hash;\n"],"names":[],"mappings":"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"}